<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>设计模式：创建型 (Creational) - MinCodes</title><meta name=Description content="MinCodes, Minimal but useful Codes"><meta property="og:title" content="设计模式：创建型 (Creational)">
<meta property="og:description" content="设计模式总目录请参考：设计模式所支持的设计的可变方面。 抽象工厂 (Abstract Factory) 意图 提供一个接口以创建一系列相关或相互依赖的对象，而无须指定它们具体的类。"><meta property="og:type" content="article"><meta property="og:url" content="https://mincodes.com/posts/design-patterns-creational/"><meta property="og:image" content="https://mincodes.com/favicon.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-07T18:35:00+08:00"><meta property="article:modified_time" content="2023-07-24T21:16:06+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mincodes.com/favicon.svg"><meta name=twitter:title content="设计模式：创建型 (Creational)"><meta name=twitter:description content="设计模式总目录请参考：设计模式所支持的设计的可变方面。 抽象工厂 (Abstract Factory) 意图 提供一个接口以创建一系列相关或相互依赖的对象，而无须指定它们具体的类。"><meta name=application-name content="MinCodes"><meta name=apple-mobile-web-app-title content="MinCodes"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mincodes.com/posts/design-patterns-creational/><link rel=prev href=https://mincodes.com/posts/design-patterns-structural/><link rel=next href=https://mincodes.com/posts/design-patterns-behavioral/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"设计模式：创建型 (Creational)","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mincodes.com\/posts\/design-patterns-creational\/"},"genre":"posts","keywords":"design-pattern, architecture","wordcount":2511,"url":"https:\/\/mincodes.com\/posts\/design-patterns-creational\/","datePublished":"2023-07-07T18:35:00+08:00","dateModified":"2023-07-24T21:16:06+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Min Deng"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=MinCodes><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>posts </a><a class=menu-item href=/tags/tools>tools </a><a class=menu-item href=/tags/>tags </a><a class=menu-item href=/about/>about </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=MinCodes><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>posts</a><a class=menu-item href=/tags/tools title>tools</a><a class=menu-item href=/tags/ title>tags</a><a class=menu-item href=/about/ title>about</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">设计模式：创建型 (Creational)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Min Deng</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-07-07>2023-07-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 2511 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 6 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#抽象工厂--abstract-factory>抽象工厂 (Abstract Factory)</a><ul><li><a href=#意图>意图</a></li><li><a href=#案例>案例</a></li><li><a href=#适用性>适用性</a></li><li><a href=#优点>优点</a></li><li><a href=#缺点>缺点</a></li><li><a href=#相关模式>相关模式</a></li></ul></li><li><a href=#工厂方法--factory-method>工厂方法 (Factory Method)</a><ul><li><a href=#意图>意图</a></li><li><a href=#类图>类图</a></li></ul></li><li><a href=#生成器--builder>生成器 (Builder)</a><ul><li><a href=#意图>意图</a></li><li><a href=#结构>结构</a><ul><li><a href=#类图>类图</a></li><li><a href=#时序图>时序图</a></li></ul></li><li><a href=#效果>效果</a><ul><li><a href=#它使你可以改变一个产品的内部表示>它使你可以改变一个产品的内部表示</a></li><li><a href=#它使你可以在不同的-director-中复用同一个-builder>它使你可以在不同的 <code>Director</code> 中复用同一个 <code>Builder</code></a></li><li><a href=#它使你对构造过程可以进行更精细的控制>它使你对构造过程可以进行更精细的控制</a></li></ul></li><li><a href=#相关模式>相关模式</a><ul><li><a href=#抽象工厂--abstract-factory----orgad84e24><a href=#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82--abstract-factory>抽象工厂 (Abstract Factory)</a></a></li><li><a href=#访问者--visitor----posts-design-patterns-behavioral-dot-pre-processed-dot-md><a href=HAHAHUGOSHORTCODE12s6HBHB>访问者 (Visitor)</a></a></li></ul></li></ul></li><li><a href=#原型--prototype>原型 (Prototype)</a><ul><li><a href=#意图>意图</a></li><li><a href=#类图>类图</a></li><li><a href=#效果>效果</a><ul><li><a href=#运行时增加和删除产品>运行时增加和删除产品</a></li><li><a href=#减少子类数量>减少子类数量</a></li></ul></li></ul></li><li><a href=#单例--singleton>单例 (Singleton)</a><ul><li><a href=#意图>意图</a></li><li><a href=#实现>实现</a><ul><li><a href=#饿汉式>饿汉式</a></li><li><a href=#双重检查锁--double-checked-locking>双重检查锁 (Double-checked locking)</a></li><li><a href=#静态内部类>静态内部类</a></li></ul></li><li><a href=#劣势>劣势</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>设计模式总目录请参考：<a href=/posts/design-patterns/#设计模式所支持的设计的可变方面 rel>设计模式所支持的设计的可变方面</a>。</p><h2 id=抽象工厂--abstract-factory>抽象工厂 (Abstract Factory)</h2><h3 id=意图>意图</h3><blockquote><p>提供一个接口以创建一系列相关或相互依赖的对象，而无须指定它们具体的类。</p></blockquote><h3 id=案例>案例</h3><p>前面在<a href=/posts/design-patterns/#dependency-inversion-principle-依赖倒置原则 rel>依赖倒置原则</a>中，其实已经举过一个贴纸的例子，其实就是抽象工厂模式的一个应用。</p><p>除了对 <code>Product</code> 和 <code>Factory</code> 进行抽象以外，抽象工厂方法还强调了​<strong>产品系列</strong>​的概念。比如《设计模式》一书中经典的例子，支持多种视感（look-and-feel）标准的用户界面，不同的视感风格为诸如滚动条、窗口和按钮等用户界面『窗口组件』定义不同的外观和行为。而某个特定视感风格下的一系列『窗口组件』，就是一个产品系列。我们不应该在 Motif 风格的窗口组件中，混入一个 PM 风格的窗口组件。</p><p>这里我们需要解决两个问题：</p><ul><li>如何确保软件不依赖某种具体的视感风格，以保证软件的可移植性。就像前面的案例中，
<code>Editor</code> 不应该直接依赖某个具体的 <code>StaticSticker</code> 一样；</li><li>如何确保我们不会在 Motif 视感中，错误的使用了一个 PM 风格的组件？</li></ul><p>我们可以通过抽象工厂模式，优雅地解决上述两个问题。看一下类图就明白了：</p><figure><img src=/ox-hugo/class-diagram-widget-factory.png></figure><p>每一种视感标准都对应一个具体的 <code>WidgetFactory</code> 子类，客户只需要通过 <code>WidgetFactory</code>
即可创建出一组特定风格的窗口组件，无需关心哪些类实现了特定风格的窗口组件，而且可以保证绝对不会错误的混用不同风格的窗口，因为 <code>WidgetFactory</code> 强化了同一类型风格组件之间的绑定关系。</p><h3 id=适用性>适用性</h3><ul><li>一个系统希望独立于它的产品的创建、组合和实现。</li><li>一个系统存在多个产品系列，在工作时需要选择其中一个产品系列来使用。</li><li>比较强调产品系列的概念，同一个系列的产品应该配合在引起使用，不同系列的产品不能混用。</li><li>提供一个产品类库，但只想暴露它们的接口而不是实现。</li></ul><h3 id=优点>优点</h3><ul><li>它分离了具体实现类</li><li>替换产品系列变得十分简单，只需替换一个 factory 即可</li><li>有利于产品的一致性，可以自动确保不同系列的产品之间不会混用</li></ul><h3 id=缺点>缺点</h3><p>该模式可以很轻易的扩展新的产品系列，但如果要扩展产品系列中的产品类型，例如上述案例中，增加一种新的窗口组件，会比较困难，因为会涉及 <code>AbstractFactory</code> 类及其所有子类的修改。</p><p>因此，使用该模式最好一开始就考虑清楚系统中有哪些产品类型，是否相对稳定，否则不太建议使用。</p><h3 id=相关模式>相关模式</h3><p>AbstractFactory 类通常用<a href=#%e5%b7%a5%e5%8e%82%e6%96%b9%e6%b3%95--factory-method rel>工厂方法 (Factory Method)</a>来实现，也可以用<a href=#%e5%8e%9f%e5%9e%8b--prototype rel>原型(Prototype)</a>
来实现。</p><p>一个具体的工厂可以作为一个<a href=#%e5%8d%95%e4%be%8b--singleton rel>单例 (Singleton)</a> 存在。</p><h2 id=工厂方法--factory-method>工厂方法 (Factory Method)</h2><h3 id=意图>意图</h3><blockquote><p>定义一个用于创建对象的接口，让子类决定具体将创建哪一种类型的实例，即对象的实例化过程被延迟到子类进行。</p></blockquote><p>工厂方法相对比较简单，其实在<a href=#%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82--abstract-factory rel>Abstract Factory 抽象工厂</a>中就有工厂方法的运用。</p><h3 id=类图>类图</h3><figure><img src=/ox-hugo/factory-method-class.png></figure><h2 id=生成器--builder>生成器 (Builder)</h2><h3 id=意图>意图</h3><blockquote><p>将一个复杂对象的构建与它的内部表示相分离，使得二者可以独立发生变化。</p></blockquote><p>这里有两层含义：</p><ul><li>构建过程（Director）和内部表示（Builder）相分离。同样的构建过程，可以生成不同的结果。例如，“解析并遍历 RTF 文档结构”这个过程是可复用的，但是我利用不同的
<code>Builder</code>, 最终可以构建出不同格式的文档（ <code>Markdown</code>, <code>Html</code>, <code>Text</code> 等）。</li><li>构建过程不用关心产品的内部组成部分是如何创建的（具体由哪些类实例化），以及这些部分是如何组装的。因此，构建过程可以被独立修改。</li></ul><h3 id=结构>结构</h3><h4 id=类图>类图</h4><figure><img src=/ox-hugo/builder-class.png></figure><h4 id=时序图>时序图</h4><figure><img src=/ox-hugo/builder-sequence.png></figure><h3 id=效果>效果</h3><h4 id=它使你可以改变一个产品的内部表示>它使你可以改变一个产品的内部表示</h4><p><code>Builder</code> 对象为 <code>Director</code> 提供了一个构造产品的抽象接口，该接口隐藏了这个产品的表示和内部结构，同时也隐藏了该产品是如何装配的。因此，当你改变该产品的内部表示时，只需替换一个 <code>Builder</code> 即可。</p><h4 id=它使你可以在不同的-director-中复用同一个-builder>它使你可以在不同的 <code>Director</code> 中复用同一个 <code>Builder</code></h4><p>例如，你可以在不同的 RTF 文档格式中，复用同一个 <code>MarkdownBuilder</code> 。</p><h4 id=它使你对构造过程可以进行更精细的控制>它使你对构造过程可以进行更精细的控制</h4><p><code>Builder</code> 模式和其他创建型模式很大的一个区别是， <code>Builder</code> 模式不是调用一个接口一下子就生成产品的，而是通过导向器一步一步构造，这个过程允许你有更高的自由度来定制整个产品。</p><h3 id=相关模式>相关模式</h3><h4 id=抽象工厂--abstract-factory----orgad84e24><a href=#%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82--abstract-factory rel>抽象工厂 (Abstract Factory)</a></h4><p>Abstract Factory 与 Builder 的主要区别在于，Builder 模式着重于一步步构造一个复杂对象。而 Abstract Factory 着重于多个系列的产品对象。另外，Builder 在最后一步返回产品，而 Abstract Factory 会立即返回产品。</p><h4 id=访问者--visitor----posts-design-patterns-behavioral-dot-pre-processed-dot-md><a href=/posts/design-patterns-behavioral/#访问者--visitor rel>访问者 (Visitor)</a></h4><p>这两个模式在某些情况下可能存在竞争关系。例如，对于一个 RTF 来说，既可以用
Visitor 模式来遍历并导出不同格式的文档（参考<a href=/posts/design-patterns-behavioral/#案例-富文本文档模型 rel>案例：富文本文档模型</a>），也可以采用
Director + 不同 Builder 的方式来导出不同格式的文档。取决于你的文档模型是否适合采用 Visitor 模式。Visitor 模式是一种更加通用的为某一类集合元素增加不同操作的方法，其目的并非要构造对象。</p><h2 id=原型--prototype>原型 (Prototype)</h2><h3 id=意图>意图</h3><blockquote><p>通过克隆原型实例的方式来创建新的对象。</p></blockquote><h3 id=类图>类图</h3><figure><img src=/ox-hugo/prototype-class.png></figure><h3 id=效果>效果</h3><p>Prototype 具备很多与其他创建型模式（例如 <a href=#%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82--abstract-factory rel>抽象工厂</a>）类似的效果，比如它对客户隐藏了具体的产品类，因此减少了客户知道的名字的数目，而且让客户无需修改即可切换到不同的具体产品。</p><p>除此之外，Prototype 有一些独有的特点，下面列举一些。</p><h4 id=运行时增加和删除产品>运行时增加和删除产品</h4><p>Prototype 可以很方便的在运行时通过注册原型实例来增加一个新的具体产品，这比抽象工厂模式相对会灵活一些。</p><h4 id=减少子类数量>减少子类数量</h4><p>使用抽象工厂会产生一个与产品类层次平行的 Factory 类层次，而 Prototype 不需要。</p><h2 id=单例--singleton>单例 (Singleton)</h2><h3 id=意图>意图</h3><blockquote><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p></blockquote><h3 id=实现>实现</h3><h4 id=饿汉式>饿汉式</h4><ul><li><p>Java 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>instance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><ul><li><p>Kotlin 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>object</span> <span class=nc>Singleton</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=双重检查锁--double-checked-locking>双重检查锁 (Double-checked locking)</h4><ul><li><p>Java 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>instance</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>Singleton</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>instance</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>instance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>volatile</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>instance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><ul><li><p>Kotlin 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span> <span class=k>private</span> <span class=k>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>instance</span><span class=p>:</span> <span class=n>Singleton</span> <span class=k>by</span> <span class=n>lazy</span><span class=p>(</span><span class=n>mode</span> <span class=p>=</span> <span class=nc>LazyThreadSafetyMode</span><span class=p>.</span><span class=n>SYNCHRONIZED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Singleton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h4 id=静态内部类>静态内部类</h4><p>这种方式利用 Java 虚拟机的类加载机制来实现懒加载的效果，并处理同步锁的问题。</p><ul><li><p>Java 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Singleton</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Holder</span><span class=p>.</span><span class=na>instance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>hello</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Singleton has been loaded!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>Singleton</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Holder</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Holder has been loaded!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Singleton</span><span class=w> </span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Singleton</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Singleton</span><span class=p>.</span><span class=na>hello</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 下面这句会触发 Holder 的加载，进而触发 instance 的初始化</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Singleton</span><span class=p>.</span><span class=na>getInstance</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul><ul><li><p>Kotlin 实现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>Singleton</span> <span class=k>private</span> <span class=k>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>init</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Singleton has been loaded!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>instance</span> <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=nc>Holder</span><span class=p>.</span><span class=n>instance</span>
</span></span><span class=line><span class=cl>        <span class=k>fun</span> <span class=nf>hello</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>println</span><span class=p>(</span><span class=s2>&#34;hello&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>object</span> <span class=nc>Holder</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>init</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Holder has been loaded!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>instance</span> <span class=p>=</span> <span class=n>Singleton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nc>Singleton</span><span class=p>.</span><span class=n>hello</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// 下面这句会触发 Holder 的加载，进而触发 instance 的初始化
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nc>Singleton</span><span class=p>.</span><span class=n>instance</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=劣势>劣势</h3><ul><li>从可测试性的角度，应该尽量减少 Singleton 的使用。因为 Singleton 难以被 mock。可以考虑用<a href=#%e6%8a%bd%e8%b1%a1%e5%b7%a5%e5%8e%82--abstract-factory rel>抽象工厂 (Abstract Factory)</a>来代替 Singleton, 并在工厂内部返回其唯一实例。</li><li>由于单例对象无法被垃圾回收，会导致部分内存或其他资源长期被占据。如果单例是一个占用较多资源的复杂对象，这可能会造成资源紧张的问题。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-07-24</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://mincodes.com/posts/design-patterns-creational/ data-title="设计模式：创建型 (Creational)" data-hashtags=design-pattern,architecture><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://mincodes.com/posts/design-patterns-creational/ data-hashtag=design-pattern><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://mincodes.com/posts/design-patterns-creational/ data-title="设计模式：创建型 (Creational)"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://mincodes.com/posts/design-patterns-creational/ data-title="设计模式：创建型 (Creational)"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://mincodes.com/posts/design-patterns-creational/ data-title="设计模式：创建型 (Creational)"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/design-pattern/>design-pattern</a>,&nbsp;<a href=/tags/architecture/>architecture</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/design-patterns-structural/ class=prev rel=prev title="设计模式：结构型 (Structural)"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>设计模式：结构型 (Structural)</a>
<a href=/posts/design-patterns-behavioral/ class=next rel=next title="设计模式：行为型 (Behavioral)">设计模式：行为型 (Behavioral)<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Min Deng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},data:{"id-1":"MinCodes","id-2":"MinCodes"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EPY7LC720X",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-EPY7LC720X" async></script></body></html>