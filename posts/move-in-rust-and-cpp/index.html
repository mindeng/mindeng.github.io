<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Rust 的 move 和 C++ 的 std::move - MinCodes</title><meta name=Description content="MinCodes, Minimal but useful Codes"><meta property="og:title" content="Rust 的 move 和 C++ 的 std::move">
<meta property="og:description" content="Rust 的 move 和 C++ 的 std::move 在表面上看有些相似之处，因为它们都涉及到数据或资源的转移。然而，它们在设计理念、实现方式以及它们在各自语言中所扮演的角色上有着"><meta property="og:type" content="article"><meta property="og:url" content="https://mincodes.com/posts/move-in-rust-and-cpp/"><meta property="og:image" content="https://mincodes.com/favicon.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-06T12:19:00+08:00"><meta property="article:modified_time" content="2024-03-06T13:44:37+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mincodes.com/favicon.svg"><meta name=twitter:title content="Rust 的 move 和 C++ 的 std::move"><meta name=twitter:description content="Rust 的 move 和 C++ 的 std::move 在表面上看有些相似之处，因为它们都涉及到数据或资源的转移。然而，它们在设计理念、实现方式以及它们在各自语言中所扮演的角色上有着"><meta name=application-name content="MinCodes"><meta name=apple-mobile-web-app-title content="MinCodes"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://mincodes.com/posts/move-in-rust-and-cpp/><link rel=prev href=https://mincodes.com/posts/publish-crate-django-auth/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Rust 的 move 和 C++ 的 std::move","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/mincodes.com\/posts\/move-in-rust-and-cpp\/"},"genre":"posts","keywords":"rust","wordcount":1069,"url":"https:\/\/mincodes.com\/posts\/move-in-rust-and-cpp\/","datePublished":"2024-03-06T12:19:00+08:00","dateModified":"2024-03-06T13:44:37+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Min Deng"},"description":""}</script><script src=https://mincodes.com/js/mathjax-config.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=MinCodes><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>posts </a><a class=menu-item href=/tags/tools>tools </a><a class=menu-item href=/tags/>tags </a><a class=menu-item href=/about/>about </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=MinCodes><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg><span class=header-title-pre><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>posts</a><a class=menu-item href=/tags/tools title>tools</a><a class=menu-item href=/tags/ title>tags</a><a class=menu-item href=/about/ title>about</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Rust 的 move 和 C++ 的 std::move</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Min Deng</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-03-06>2024-03-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1069 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#rust-中的-move-语义>Rust 中的 Move 语义</a></li><li><a href=#c-plus-plus-中的-move-语义>C++ 中的 Move 语义</a></li><li><a href=#异同点分析>异同点分析</a></li><li><a href=#深入到内存层面>深入到内存层面</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class=content id=content><p>Rust 的 <code>move</code> 和 C++ 的 <code>std::move</code> 在表面上看有些相似之处，因为它们都涉及到数据或资源的转移。然而，它们在设计理念、实现方式以及它们在各自语言中所扮演的角色上有着根本的区别。</p><h2 id=rust-中的-move-语义>Rust 中的 Move 语义</h2><dl><dt>所有权转移</dt><dd>Rust 中的 move 语义是其所有权系统的核心部分。当一个值从一个变量移动到另一个变量时，原始变量不再有权访问该值。这避免了悬垂指针和数据竞争等问题。</dd><dt>编译时检查</dt><dd>Rust 的编译器在编译时就会检查所有权、借用和生命周期规则，确保内存安全而无需运行时开销。</dd><dt>自动控制</dt><dd>Rust 的 move 语义是通过编译器自动实现的，不需要程序员提供特殊的代码来支持 move
语义。</dd></dl><h2 id=c-plus-plus-中的-move-语义>C++ 中的 Move 语义</h2><dl><dt>资源转移</dt><dd>C++11 引入了 move 语义，主要用于优化资源管理，减少不必要的对象复制。通过
<code>std::move</code> ，可以将一个对象的状态或资源转移到另一个对象，原对象则处于一个有效但未定义的状态。</dd><dt>标准库的支持</dt><dd>C++ 的 move 语义与其标准库紧密结合，许多容器和算法都对 move 语义进行了优化。</dd><dt>手动控制</dt><dd>与 Rust 的自动和严格的所有权模型不同，C++ 程序员需要更多地手动管理资源和使用
move 语义，这提供了灵活性但也增加了错误的可能性。<p>具体来讲，C++ 的 move 语义是通过类的『移动构造函数』和『移动赋值运算符』来提供支持的。</p></dd></dl><h2 id=异同点分析>异同点分析</h2><dl><dt>设计理念</dt><dd>Rust 的 move 语义设计主要是为了实现内存安全和线程安全，而 C++ 的 move 语义更多是为了性能优化和资源管理。</dd><dt>实现机制</dt><dd>Rust 在编译时强制执行所有权规则，几乎不允许违反这些规则的代码通过编译。而 C++
给了程序员更多的控制权，但这也意味着更高的出错风险。</dd><dt>使用场景</dt><dd>Rust 的 move 用于所有权转移，强调安全和清晰的所有权模型。C++ 的 move 更多是用于性能优化，尤其是在处理大型对象或资源密集型对象时。</dd></dl><h2 id=深入到内存层面>深入到内存层面</h2><p>如果我们深入到内存层面，就会发现，Rust 的 move 和 C++ 的 move 又有一些相似之处。</p><p>就内存操作而言，Rust 中的 move 过程本质上是对数据结构的浅拷贝<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。以 <code>Vec&lt;T></code> 为例，
move 操作涉及到的只是对数据结构内部字段（指针、长度和容量等）的拷贝，而不会触及堆上的数据本身。这点和 C++ 的『移动构造函数』的实现很相似，区别在于：</p><ul><li>C++ 在浅拷贝之后，需要将原始对象的字段重置，以防止析构函数多次释放资源。</li><li>Rust 则直接通过编译器保证原始对象不再可用，在安全性上更胜一筹。</li></ul><p>当然，如前所述，整个过程 Rust 是自动完成的，而 C++ 需要由程序员来手工完成。</p><h2 id=总结>总结</h2><p>综上所述，Rust 的 move 和 C++ 的 move 在设计理念、实现机制和使用场景方面都存在较大差异，但两者在资源转移方面又有一些相似之处，例如都可以通过浅拷贝来完成资源的高效转移。通过这种对比分析，我们可以更进一步理解 <code>move</code> 这个概念。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>这点可以通过生成 Rust 源码的 LLVM IR 来验证（命令： <code>cargo rustc -- --emit=llvm-ir</code> ），例如这个<a href=https://stackoverflow.com/a/30290070/1066512 target=_blank rel="noopener noreffer">案例</a>。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-03-06</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://mincodes.com/posts/move-in-rust-and-cpp/ data-title="Rust 的 move 和 C++ 的 std::move" data-hashtags=rust><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://mincodes.com/posts/move-in-rust-and-cpp/ data-hashtag=rust><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://mincodes.com/posts/move-in-rust-and-cpp/ data-title="Rust 的 move 和 C++ 的 std::move"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://mincodes.com/posts/move-in-rust-and-cpp/ data-title="Rust 的 move 和 C++ 的 std::move"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://mincodes.com/posts/move-in-rust-and-cpp/ data-title="Rust 的 move 和 C++ 的 std::move"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/rust/>Rust</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/publish-crate-django-auth/ class=prev rel=prev title="发布我的第一个 Crate: django-auth"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>发布我的第一个 Crate: django-auth</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Min Deng</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},data:{"id-1":"MinCodes","id-2":"MinCodes"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EPY7LC720X",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-EPY7LC720X" async></script></body></html>